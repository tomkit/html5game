(function(a){function r(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)}function s(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent(b,c)}function t(a){a.preventDefault?(a.preventDefault(),a.stopPropagation()):a.returnValue=!1}function u(a,b){return(a%b+b)%b}function v(a,b){return Math.sqrt(a*a+b*b)}function w(a,b,c){var d=v(a,b);return d===0?{x:a,y:b}:c?{x:a/d*c,y:b/d*c}:{x:a/d,y:b/d}}function x(a,b,c,d,e,f){var g=(c-a)*(f-b)-(d-b)*(e-a);return g===0?null:g>0}function y(a,b){var c=b.shift();while(c){if(typeof a[c]!="undefined")return c;c=b.shift()}}function z(){b.tproperty=y(l.body.style,["transform","webkitTransform","MozTransform","OTransform","msTransform"]),b.animationFrame=y(a,["requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame"]),b.createEventProperty=y(l,["createEvent","createEventObject"]),p=!0}function A(a,b,c,d){return a&&a[b]!==undefined?d==="int"?a[b]|0:a[b]:c}function B(a,b,c,d){var e=l.createElement("div"),f=e.style;return f.top=b+"px",f.left=a+"px",f.width=c+"px",f.height=d+"px",f.color="#fff",f.zIndex=100,f.position="absolute",f.backgroundColor="#000",f.opacity=.7,e}function i(a){return C||(C=new j(a)),C}function E(a){D||(D=l.createElement("textarea"),D.style.height="200px",D.style.width=window.innerWidth-100+"px",l.body.appendChild(D)),D.value=D.value+a,D.scrollTop=D.scrollHeight}function F(){if(!b.debug)return;var a="";for(var c=0;c<arguments.length;c++)a+=arguments[c]+" ";E(a+"\r\n")}var b,c,d,e,f,g,h,i,j,k,l=a.document,m=0,n=0,o=0,p=!1,q=1;d=function G(c){if(this.constructor!==G)return new G(c);p||z(),this.autoPause=A(c,"autoPause",!0),this.main=A(c,"main",function(){});var d=l.createElement("div"),e;return d.style.overflow="hidden",d.style.imageRendering="-webkit-optimize-contrast",d.style.position="relative",d.className="sjs",d.id="sjs"+n,this.id=n,n+=1,e=A(c,"parent",l.body),e.appendChild(d),this.w=A(c,"w",480,"int"),this.h=A(c,"h",320,"int"),this.dom=d,this.dom.style.width=this.w+"px",this.dom.style.height=this.h+"px",this.layers={},this.ticker=null,this.useCanvas=A(c,"useCanvas",a.location.href.indexOf("canvas")!==-1),this.xscale=1,this.yscale=1,this.Layer("default"),b.scenes.push(this),this},d.prototype.constructor=d,d.prototype.Sprite=function(d,e){return e===undefined&&b.error("When you create Sprite from the scene the layer should be specified or false."),new c(this,d,e)},d.prototype.Layer=function(b,c){return new e(this,b,c)},d.prototype.Cycle=function(b){return new h(b)},d.prototype.Input=function(){return this.input=new i(this),this.input},d.prototype.scale=function(c,d){this.xscale=c,this.yscale=d,this.dom.style[b.tproperty+"Origin"]="0 0",this.dom.style[b.tproperty]="scale("+c+","+d+")"},d.prototype.toString=function(){return"Scene("+String(this.id)+")"},d.prototype.reset=function(){var b;this.ticker&&this.ticker.pause();for(b in this.layers)this.layers.hasOwnProperty(b)&&(this.layers[b].dom.parentNode.removeChild(this.layers[b].dom),delete this.layers[b]);while(this.dom.childNodes.length>=1)this.dom.removeChild(this.dom.firstChild);this.layers={},this.Layer("default")},d.prototype.Ticker=function(b,c){return this.ticker&&(this.ticker.pause(),this.ticker.paint=function(){}),this.ticker=new g(this,b,c),this.ticker},d.prototype.loadImages=function(c,d){d||(d=this.main);var e=0,f,g,h,i,j,k,m;for(m=0;m<c.length;m++)b.spriteCache[c[m]]||(e+=1,b.spriteCache[c[m]]={src:c[m],loaded:!1,loading:!1});if(e===0)return d();f=e,g=B(0,0,this.w,this.h),g.style.textAlign="center",g.style.paddingTop=this.h/2-16+"px",g.innerHTML="Loading",this.dom.appendChild(g),k=this,j=!1;var n=function(a){b.spriteCache[a].loading=!0,h=l.createElement("img"),b.spriteCache[a].img=h,r(h,"load",function(){b.spriteCache[a].loaded=!0,e-=1,j===!1&&(e===0?(k.dom.removeChild(g),d()):g.innerHTML="Loading "+((f-e)/f*100|0)+"%")},!1),r(h,"error",function(){j=!0,g.innerHTML="Error loading image "+a},!1),h.src=a};for(i in b.spriteCache)b.spriteCache.hasOwnProperty(i)&&(b.spriteCache[i].loading||n(i))},c=function(b,c,d){this.scene=b,this._dirty={},this.changed=!1,this.y=0,this.x=0,this._x_before=0,this._x_rounded=0,this._y_before=0,this._y_rounded=0,this.xv=0,this.yv=0,this.rv=0,this.type="rectangle",this.mass=1,this.friction=.05,this.xf=0,this.yf=0,this.src=null,this.img=null,this.imgNaturalWidth=null,this.imgNaturalHeight=null,this.w=null,this.h=null,this.xoffset=0,this.yoffset=0,this.dom=null,this.cycle=null,this.xscale=1,this.yscale=1,this.angle=0,this.xTransformOrigin=null,this.yTransformOrigin=null,this.backgroundRepeat=null,this.opacity=1,this.color=!1,this.id=++m,this.layer=null;var e,f,g,h,i,j,k;if(d)if(d.sprites)this.layer=d;else{k=d;for(j in k)k.hasOwnProperty(j)&&(e=k[j],f=this[j],typeof f=="function"?this[j].apply(this,e):f!==undefined&&(h=j.charAt(0),(h==="x"||h==="y")&&j.length>1?g="set"+h.toUpperCase()+j.charAt(1).toUpperCase()+j.slice(2):g="set"+h.toUpperCase()+j.slice(1),this[g]?this[g].apply(this,[e]):this[j]=e))}if(this.layer===undefined||d===undefined)this.layer=b.layers["default"];return this.layer&&!this.layer.useCanvas&&(i=l.createElement("div"),i.style.position="absolute",this.dom=i,this.layer.dom.appendChild(i)),c&&this.loadImg(c),this},c.prototype.constructor=c,c.prototype.setX=function(b){return this.x=b,this._x_rounded=b|0,this.changed=!0,this},c.prototype.setY=function(b){return this.y=b,this._y_rounded=b|0,this.changed=!0,this},c.prototype.setW=function(b){return this.w=b,this._dirty.w=!0,this.changed=!0,this},c.prototype.setH=function(b){return this.h=b,this._dirty.h=!0,this.changed=!0,this},c.prototype.setXOffset=function(b){return this.xoffset=b,this._dirty.xoffset=!0,this.changed=!0,this},c.prototype.setYOffset=function(b){return this.yoffset=b,this._dirty.yoffset=!0,this.changed=!0,this},c.prototype.setAngle=function(b){return this.angle=b,this._dirty.angle=!0,this.changed=!0,this},c.prototype.setColor=function(b){return this.color=b,this._dirty.color=!0,this.changed=!0,this},c.prototype.setOpacity=function(b){return this.opacity=b,this._dirty.opacity=!0,this.changed=!0,this},c.prototype.setXScale=function(b){return this.xscale=b,this._dirty.xscale=!0,this.changed=!0,this},c.prototype.setYScale=function(b){return this.yscale=b,this._dirty.yscale=!0,this.changed=!0,this},c.prototype.transformOrigin=function(b,c){return this.xTransformOrigin=b,this.yTransformOrigin=c,this._dirty.transform=!0,this.changed=!0,this},c.prototype.setBackgroundRepeat=function(b){return this._dirty.backgroundRepeat=!0,this.backgroundRepeat=b,this},c.prototype.rotate=function(a){return this.setAngle(this.angle+a),this},c.prototype.orient=function(b,c){var d=Math.atan2(c,b);this.setAngle(d)},c.prototype.scale=function(a,b){return this.xscale!==a&&this.setXScale(a),b===undefined&&(b=a),this.yscale!==b&&this.setYScale(b),this},c.prototype.move=function(a,b){return this.setX(this.x+a),this.setY(this.y+b),this},c.prototype.position=function(a,b){return this.setX(a),this.setY(b),this},c.prototype.offset=function(a,b){return this.setXOffset(a),this.setYOffset(b),this},c.prototype.size=function(a,b){return this.setW(a),this.setH(b),this},c.prototype.toFront=function(){return this.layer.lastZIndex++,this.setZIndex(this.layer.lastZIndex)},c.prototype.toBack=function(){return this.layer.lastZIndex++,this.setZIndex(-this.layer.lastZIndex)},c.prototype.setZIndex=function(a){return this.dom&&this.layer&&(this._dirty.zindex=!0,this.changed=!0,this.zindex=a),this},c.prototype.setForce=function(b,c){this.xf=b,this.yf=c},c.prototype.addForce=function(b,c){this.xf+=b,this.yf+=c},c.prototype.applyForce=function(b){b===undefined&&(b=1),this.xv-=this.friction*this.xv*this.mass*b,this.xv+=this.xf/this.mass*b,this.yv-=this.friction*this.yv*this.mass*b,this.yv+=this.yf/this.mass*b},c.prototype.velocity=function(){return v(this.xv,this.yv)},c.prototype.setVelocity=function(a,b){this.xv=a,this.yv=b},c.prototype.addVelocity=function(a,b){this.xv+=a,this.yv+=b},c.prototype.applyVelocity=function(a){return a===undefined&&(a=1),this.xv!==0&&this.setX(this.x+this.xv*a),this.yv!==0&&this.setY(this.y+this.yv*a),this.rv!==0&&this.setAngle(this.angle+this.rv*a),this},c.prototype.reverseVelocity=function(a){return a===undefined&&(a=1),this.xv!==0&&this.setX(this.x-this.xv*a),this.yv!==0&&this.setY(this.y-this.yv*a),this.rv!==0&&this.setAngle(this.angle-this.rv*a),this},c.prototype.applyXVelocity=function(a){a===undefined&&(a=1),this.xv!==0&&this.setX(this.x+this.xv*a)},c.prototype.reverseXVelocity=function(a){a===undefined&&(a=1),this.xv!==0&&this.setX(this.x-this.xv*a)},c.prototype.applyYVelocity=function(a){a===undefined&&(a=1),this.yv!==0&&this.setY(this.y+this.yv*a)},c.prototype.reverseYVelocity=function(a){a===undefined&&(a=1),this.yv!==0&&this.setY(this.y-this.yv*a)},c.prototype.rotateVelocity=function(a){var b=this.xv*Math.cos(a)-this.yv*Math.sin(a);this.yv=this.xv*Math.sin(a)+this.yv*Math.cos(a),this.xv=b},c.prototype.orientVelocity=function(a,b){var c=v(this.xv,this.yv),d;d=w(a,b,c),this.xv=d.x,this.yv=d.y},c.prototype.remove=function(){this.cycle&&this.cycle.removeSprite(this),this.layer&&!this.layer.useCanvas&&(this.layer.dom.removeChild(this.dom),this.dom=null),this.texture&&this.texture.remove(),this.texture=null,this.layer=null,this.img=null},c.prototype.webGLUpdate=function(){return this.texture||(this.texture=new webgl.Texture(this)),this.texture.render(this.x,this.y),this},c.prototype.update=function(){if(this.layer.scene.disableUpdate)return this;if(this.layer.useWebGL)return this.webGLUpdate();if(this.layer.useCanvas)return this.canvasUpdate();var c=this.dom.style,d;this._x_before!==this._x_rounded&&(c.left=(this.x|0)+"px"),this._y_before!==this._y_rounded&&(c.top=(this.y|0)+"px"),this._x_before=this._x_rounded,this._y_before=this._y_rounded;if(!this.changed)return this;this._dirty.w&&(c.width=(this.w|0)+"px"),this._dirty.h&&(c.height=(this.h|0)+"px");if(this._dirty.xoffset||this._dirty.yoffset)c.backgroundPosition=-(this.xoffset|0)+"px "+ -(this.yoffset|0)+"px";this._dirty.opacity&&(c.opacity=this.opacity),this._dirty.color&&(c.backgroundColor=this.color),this._dirty.zindex&&(c.zIndex=this.zindex),this._dirty.transform&&(c[b.tproperty+"Origin"]=this.xTransformOrigin+" "+this.yTransformOrigin),this._dirty.backgroundRepeat&&(c.backgroundRepeat=this.backgroundRepeat);if(this._dirty.xscale||this._dirty.yscale||this._dirty.angle){d="",this.angle!==0&&(d+="rotate("+this.angle+"rad) ");if(this.xscale!==1||this.yscale!==1)d+=" scale("+this.xscale+", "+this.yscale+")";c[b.tproperty]=d}return this.changed=!1,this._dirty={},this},c.prototype.canvasUpdate=function(b){var c,d,e,f,g;b?c=b.ctx:c=this.layer.ctx;var h=this.angle==0&&this.opacity==1&&this.imgNaturalWidth==this.w&&this.imgNaturalHeight==this.h&&this.xTransformOrigin===null;if(h)return c.drawImage(this.img,this.xoffset,this.yoffset,this.w,this.h,this._x_rounded,this._y_rounded,this.w,this.h),this;c.save(),this.xTransformOrigin===null?(d=this.w/2|0,e=this.h/2|0):(d=this.xTransformOrigin,e=this.yTransformOrigin),c.translate(this._x_rounded+d,this._y_rounded+e),c.rotate(this.angle),(this.xscale!==1||this.yscale!==1)&&c.scale(this.xscale,this.yscale),c.globalAlpha=this.opacity,c.translate(-d,-e),this.color&&(c.fillStyle=this.color,c.fillRect(0,0,this.w,this.h));if(this.imgLoaded&&this.img)if(this.imgNaturalWidth<this.w||this.imgNaturalHeight<this.h){f=Math.floor(this.w/this.imgNaturalWidth);while(f>0){f-=1,g=Math.floor(this.h/this.imgNaturalHeight);while(g>0)g-=1,c.drawImage(this.img,this.xoffset,this.yoffset,this.imgNaturalWidth,this.imgNaturalHeight,f*this.imgNaturalWidth,g*this.imgNaturalHeight,this.imgNaturalWidth,this.imgNaturalHeight)}}else c.drawImage(this.img,this.xoffset,this.yoffset,this.w,this.h,0,0,this.w,this.h);return c.restore(),this},c.prototype.toString=function(){return"Sprite("+String(this.id)+")"},c.prototype.onload=function(a){this.imgLoaded&&this._callback&&(this._callback=a)},c.prototype.loadImg=function(a,c){function g(d){f=e.img,b.spriteCache[a].loaded=!0,e.imgLoaded=!0,e.layer&&!e.layer.useCanvas&&(e.dom.style.backgroundImage="url("+a+")"),e.imgNaturalWidth=f.width,e.imgNaturalHeight=f.height,(e.w===null||c)&&e.setW(f.width),(e.h===null||c)&&e.setH(f.height),e.onload()}var d,e=this,f;return this.src=a,b.spriteCache[a]?(this.img=b.spriteCache[a].img,d=b.spriteCache[a].loaded):(this.img=l.createElement("img"),b.spriteCache[a]={src:a,img:this.img,loaded:!1,loading:!0},d=!1),d?g():(r(this.img,"load",g,!1),this.img.src=a),this},c.prototype.distance=function(b,c){return typeof b=="number"?Math.sqrt(Math.pow(this.x+this.w/2-b,2)+Math.pow(this.y+this.h/2-c,2)):Math.sqrt(Math.pow(this.x+this.w/2-(b.x+b.w/2),2)+Math.pow(this.y+this.h/2-(b.y+b.h/2),2))},c.prototype.center=function(){return{x:this.x+this.w/2,y:this.y+this.h/2}},c.prototype.explode2=function(b,c,d){d||(d=this.layer);var e={layer:d,color:this.color};b===undefined&&(c?b=this.h/2:b=this.w/2),b|=0;var f=d.scene.Sprite(this.src,e),g=d.scene.Sprite(this.src,e);return c?(f.size(this.w,b),f.position(this.x,this.y),g.size(this.w,this.h-b),g.position(this.x,this.y+b),g.setYOffset(b)):(f.size(b,this.h),f.position(this.x,this.y),g.size(this.w-b,this.h),g.position(this.x+b,this.y),g.setXOffset(b)),[f,g]},c.prototype.explode4=function(b,c,d){b===undefined&&(b=this.w/2),c===undefined&&(c=this.h/2),b|=0,c|=0,d||(d=this.layer);var e={layer:d,color:this.color},f=d.scene.Sprite(this.src,e),g=d.scene.Sprite(this.src,e),h=d.scene.Sprite(this.src,e),i=d.scene.Sprite(this.src,e);return f.size(b,c),f.position(this.x,this.y),g.size(this.w-b,c),g.position(this.x+b,this.y),g.offset(b,0),h.size(this.w-b,this.h-c),h.position(this.x+b,this.y+c),h.offset(b,c),i.size(b,this.h-c),i.position(this.x,this.y+c),i.offset(0,c),[f,g,h,i]},h=function H(a){if(this.constructor!==H)return new H(a);var b,c;this.triplets=a,this.cycleDuration=0,this.changingTicks=[0];for(b=0;c=a[b];b++)this.cycleDuration=this.cycleDuration+c[2],this.changingTicks.push(this.cycleDuration);this.currentTripletIndex=undefined,this.sprites=[],this.repeat=!0,this.tick=0,this.done=!1,this.id=++o},h.prototype.addSprite=function(b){return this.sprites.push(b),b.cycle=this,this},h.prototype.toString=function(){return"Cycle("+String(this.id)+")"},h.prototype.update=function(){var b=this.sprites,c,d;for(c=0;d=b[c];c++)d.update();return this},h.prototype.addSprites=function(b){this.sprites=this.sprites.concat(b);var c,d;for(c=0;d=b[c];c++)d.cycle=this;return this},h.prototype.removeSprite=function(b){var c,d;for(c=0;d=this.sprites[c];c++)b==d&&(d.cycle=null,this.sprites.splice(c,1));return this},h.prototype.next=function(a,b){if(this.tick>this.cycleDuration){if(!this.repeat)return this.done=!0,this;this.tick=0}var c,d,e,f;for(d=0;d<this.changingTicks.length-1;d++)if(this.tick>=this.changingTicks[d]&&this.tick<=this.changingTicks[d+1]){c=d;break}if(c!==undefined&&c!==this.currentTickIndex){for(e=0;f=this.sprites[e];e++)f.setXOffset(this.triplets[d][0]),f.setYOffset(this.triplets[d][1]),b&&f.update();this.currentTripletIndex=c}return a=a||1,this.tick=this.tick+a,this},h.prototype.reset=function(b){var c,d;this.tick=0,this.done=!1;for(c=0;d=this.sprites[c];c++)d.setXOffset(this.triplets[0][0]),d.setYOffset(this.triplets[0][1]),b&&d.update();return this},h.prototype.go=function(b){var c,d;for(c=0;d=this.sprites[c];c++)d.setXOffset(this.triplets[b][0]),d.setYOffset(this.triplets[b][1]);return this},g=function I(a,c,d){if(typeof c=="number"){var e=c;c=d,d={tickDuration:e}}this.scene=a;if(this.constructor!==I)return new I(tickDuration,c);this.tickDuration=A(d,"tickDuration",16),this.expectedFps=1e3/this.tickDuration,this.useAnimationFrame=A(d,"useAnimationFrame",!1),b.animationFrame||(this.useAnimationFrame=!1),this.paint=c,this.start=(new Date).getTime(),this.now=this.start,this.ticksElapsed=0,this.currentTick=0,this.ticksSinceLastStart=0,this.droppedFrames=0,this.lowFrameRate=!1},g.prototype.next=function(){var a=(new Date).getTime();return this.diff=a-this.now,this.now=a,this.lastTicksElapsed=Math.round(this.diff/this.tickDuration),this.droppedFrames+=Math.max(0,this.lastTicksElapsed-1),this.ticksSinceLastStart+=this.lastTicksElapsed,this.currentTick+=this.lastTicksElapsed,this.lastTicksElapsed},g.prototype.run=function(){if(this.paused)return;this.lowFrameRate||this.load>20&&this.fps<this.expectedFps/2?(this.lowFrameRate=!0,this.skippedFrames==1?(this.skippedFrames=0,this.skipPaint=!0,this.scene.disableUpdate=!0):(this.skippedFrames=1,this.skipPaint=!1,this.scene.disableUpdate=!1)):this.skipPaint=!1;var c=this,d=this.next();if(d==0){setTimeout(function(){c.run()},this.tickDuration);return}if(!this.skipPaint)for(var e in this.scene.layers){var f=this.scene.layers[e];f.useCanvas&&f.autoClear&&f.clear()}this.paint(this),this.scene.input&&this.scene.input.next(),this.timeToPaint=(new Date).getTime()-this.now,this.load=(this.timeToPaint/this.tickDuration*100+this.load)/2|0,this.fps=Math.round(1e3/(this.now-(this.lastPaintAt||0))),this.lastPaintAt=this.now;if(this.useAnimationFrame)this.tickDuration=16,a[b.animationFrame](function(){c.run()});else{var g=Math.max(this.tickDuration-this.timeToPaint,6);this.timeout=setTimeout(function(){c.run()},g)}},g.prototype.pause=function(){a.clearTimeout(this.timeout),a[b.animationFrame]=undefined,this.paused=!0},g.prototype.resume=function(){this.start=(new Date).getTime(),this.ticksElapsed=0,this.ticksSinceLastStart=0,this.paused=!1,this.run()};var C=!1;j=function(d){function f(a,b){if(!e.enableCustomEvents)return;if(l.createEvent){var c=l.createEvent("Events");c.initEvent("sjs"+a,!0,!0),c.value=b,e.dom.dispatchEvent(c)}else if(l.createEventObject){var c=l.createEventObject();c.value=b,e.dom.fireEvent("onsjs"+a,c)}}function g(a,b){f(a,b),(a=="space"||a=="enter")&&g("action",b),e.keyboard[a]!==b&&(e.keyboard[a]=b,e.keyboardChange[a]=b)}function h(a,b){(a.keyCode==40||a.keyCode==83)&&g("down",b),(a.keyCode==38||a.keyCode==87)&&g("up",b),(a.keyCode==39||a.keyCode==68)&&g("right",b),(a.keyCode==37||a.keyCode==65)&&g("left",b),a.keyCode==32&&g("space",b),a.keyCode==17&&g("ctrl",b),a.keyCode==13&&g("enter",b),a.keyCode==27&&g("esc",b);if(a.keyCode>=48&&a.keyCode<=90){var c=String.fromCharCode(a.keyCode);g(c.toLowerCase(),b)}}function j(a){e.mouse.click={x:(a.clientX-e.dom.offsetLeft)/d.xscale,y:(a.clientY-e.dom.offsetTop)/d.yscale}}function k(a){e.mousedown=!0,e.mouse.down=!0,e.mousepressed=!0,t(a)}function m(a){e.mousedown=!1,e.mouse.down=!1,e.mousereleased=!0,e.mouse.click={x:(a.clientX-e.dom.offsetLeft)/d.xscale,y:(a.clientY-e.dom.offsetTop)/d.yscale}}function n(a){e.mouse.position={x:(a.clientX-e.dom.offsetLeft)/d.xscale,y:(a.clientY-e.dom.offsetTop)/d.yscale}}function o(a){return a.touches&&a.touches.length?a=a.touches[0]:a.changedTouches&&a.changedTouches.length&&(a=a.changedTouches[0]),a}d?this.dom=d.dom:this.dom=l.body;var e=this;this.keyboard={},this.mouse={position:{},click:undefined},this.keyboardChange={},this.mousedown=!1,e.mousepressed=!1,this.mousereleased=!1,this.keydown=!1,this.touchMoveSensibility=20,this.enableCustomEvents=!1,this.touchable="ontouchstart"in a,this.next=function(){this.disableFor&&(this.disableFor=e.disableFor-1),this.keyboardChange={},this.mousepressed=!1,this.mouse.click=undefined,this.mousereleased=!1},this.disableFor=0,this.disable=function(a){e.disableFor=a},this.keyPressed=function(a){return e.keyboardChange[a]!==undefined&&e.keyboardChange[a]},this.keyReleased=function(a){return e.keyboardChange[a]!==undefined&&!e.keyboardChange[a]},this.arrows=function(){return this.keyboard.right||this.keyboard.left||this.keyboard.up||this.keyboard.down};var i=function(b,c){r(a,b,c,!1)};this.touchable&&(i("touchstart",function(a){a=o(a),g("space",!0),j(a),e.touchStart={x:a.clientX,y:a.clientY}}),i("touchend",function(a){m(a),e.keyboard={},e.touchStart=null}),i("touchmove",function(a){t(a),a=o(a),g("space",!1),n(a);if(e.touchStart){var b=a.clientX-e.touchStart.x,c=a.clientY-e.touchStart.y;c<-e.touchMoveSensibility?(g("up",!0),g("down",!1)):c>e.touchMoveSensibility?(g("down",!0),g("up",!1)):(g("up",!1),g("down",!1)),b<-e.touchMoveSensibility?(g("left",!0),g("right",!1)):b>e.touchMoveSensibility?(g("right",!0),g("left",!1)):(g("left",!1),g("right",!1))}}),i("touchmove",function(a){a=o(a),n(a)})),i("mousedown",k),i("mouseup",m),i("click",j),i("mousemove",n),i("keydown",function(a){e.keydown=!0,h(a,!0)}),i("keyup",function(a){e.keydown=!1,h(a,!1)}),i("keypress",function(a){}),b.debug||i("contextmenu",function(a){t(a)})},r(a,"blur",function(a){for(var c=0;c<b.scenes.length;c++){var d=b.scenes[c];if(!d.autoPause)continue;var e=function(a){C.keyboard={},C.keydown=!1,C.mousedown=!1;if(a.ticker&&!a.ticker.paused){a.ticker.pause();var b=B(0,0,a.w,a.h);b.innerHTML="<h1>Paused</h1><p>Click or press any key to resume.</p>",b.style.textAlign="center",b.style.paddingTop=a.h/2-32+"px";var c=function(d){t(d),a.dom.removeChild(b),s(l,"click",c,!1),s(l,"keyup",c,!1),a.ticker.resume()};r(l,"click",c,!1),r(l,"keyup",c,!1),a.dom.appendChild(b)}};e(d)}},!1),e=function J(a,c,d){var e,f,g,h;if(!this||this.constructor!==J)return new J(a,c,d);this.sprites={},this.scene=a,d===undefined&&(d={useCanvas:a.useCanvas,autoClear:!0}),d.useWebGL&&(d.useCanvas=!0),d.autoClear===undefined?this.autoClear=!0:this.autoClear=d.autoClear,d.useCanvas===undefined?this.useCanvas=this.scene.useCanvas:this.useCanvas=d.useCanvas,this.useWebGL=d.useWebGL,this.name=c;if(this.scene.layers[c]!==undefined)return b.debug&&b.warning("A layer named "+c+" already exist."),this.scene.layers[c];this.scene.layers[c]=this,this.lastZIndex=0,e=l.getElementById(c),e?f=!1:f=!0,this.useCanvas?(e&&e.nodeName.toLowerCase()!=="canvas"&&b.error("Cannot use HTMLElement "+e.nodeName+" with canvas renderer."),f&&(e=l.createElement("canvas"))):f&&(e=l.createElement("div")),f?(g=!1,h=!1):(g=e.height||e.style.height,h=e.width||e.style.width),d.parent?this.parent=d.parent:this.parent=this.scene.dom,this.parent.appendChild(e),e.id=e.id||"sjs"+a.id+"-"+c,d.disableAutoZIndex||(q+=1,e.style.zIndex=String(q)),e.style.backgroundColor=d.color||e.style.backgroundColor,this.h=d.h||g||a.h,this.w=d.w||h||a.w,e.nodeName=="CANVAS"?(e.height=this.h,e.width=this.w):(e.style.height=this.h+"px",e.style.width=this.w+"px"),e.style.position="absolute",e.style.top=e.style.top||"0px",e.style.left=e.style.left||"0px",this.dom=e,this.useCanvas&&(d.useWebGL?this.ctx=webgl.init(e):this.ctx=e.getContext("2d"))},e.prototype.constructor=e,e.prototype.clear=function(){this.useWebGL?this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT):this.ctx.clearRect(0,0,this.dom.width,this.dom.height)},e.prototype.Sprite=function(a,b){return b?b.layer=this:b=this,new c(this.scene,a,b)},e.prototype.remove=function(){this.parent.removeChild(this.dom),delete this.scene.layers[this.name]},e.prototype.addSprite=function(b){var c=Math.random()*11;return this.sprites[c]=b,c},e.prototype.setColor=function(b){this.dom.style.backgroundColor=b},e.prototype.onTop=function(b){q+=1,this.dom.style.zIndex=String(q)},k=function K(a){if(this.constructor!==K)return new K(a);this.list=a&&(a.list||a)||[],this.length=this.list.length,this.index=-1},k.prototype.add=function(b){b.length?this.list.push.apply(this.list,b):this.list.push(b),this.length=this.list.length},k.prototype.append=k.prototype.add,k.prototype.remove=function(b){var c=!1;for(var d=0,e;e=this.list[d];d++)e==b&&(this.list.splice(d,1),this.index>-1&&(this.index=this.index-1),d--,c=!0);return this.length=this.list.length,c},k.prototype.iterate=function(){return this.index+=1,this.index>=this.list.length?(this.index=-1,!1):this.list[this.index]},k.prototype.pop=function(){return this.length-=1,this.list.pop()},k.prototype.shift=function(){return this.index-=1,this.length-=1,this.list.shift()},k.prototype.isIn=function(b){for(var c=0;c<this.list.length;c++)if(this.list[c]==b)return!0;return!1},k.prototype.filter=function(b,c){var d=new k;for(var e=0;e<this.list.length;e++)this.list[e][b]==c&&d.add(this.list[e]);return d},k.prototype.empty=function(){this.list=[],this.length=0,this.index=-1};var D=null,b={spriteCache:{},debug:!1,Cycle:h,Input:i,Scene:d,SpriteList:k,List:k,Sprite:c,overlay:B,scenes:[],error:function(b){F("Error: "+b)},warning:function(b){F("Warning: "+b)},log:F,createEvent:null,math:{hypo:v,mod:u,normalVector:w,lineSide:x}};a.sjs=b})(this);var requirejs,require,define;(function(a){function b(a,b){if(a&&a.charAt(0)==="."&&b){b=b.split("/"),b=b.slice(0,b.length-1),a=b.concat(a.split("/"));var c,d;for(c=0;d=a[c];c++)if(d===".")a.splice(c,1),c-=1;else if(d===".."){if(c===1&&(a[2]===".."||a[0]===".."))break;c>0&&(a.splice(c-1,2),c-=2)}a=a.join("/")}return a}function c(b,c){return function(){return l.apply(a,j.call(arguments,0).concat([b,c]))}}function d(a){return function(c){return b(c,a)}}function e(a){return function(b){h[a]=b}}function f(b){if(i.hasOwnProperty(b)){var c=i[b];delete i[b],k.apply(a,c)}return h[b]}function g(a,c){var e,g,h=a.indexOf("!");return h!==-1?(e=b(a.slice(0,h),c),a=a.slice(h+1),g=f(e),g&&g.normalize?a=g.normalize(a,d(c)):a=b(a,c)):a=b(a,c),{f:e?e+"!"+a:a,n:a,p:g}}var h={},i={},j=[].slice,k,l;if(typeof define=="function")return;k=function(b,d,j,k){var l=[],m,n,o,p,q,r;k||(k=b);if(typeof j=="function"){!d.length&&j.length&&(d=["require","exports","module"]);for(p=0;p<d.length;p++){r=g(d[p],k),o=r.f;if(o==="require")l[p]=c(b);else if(o==="exports")l[p]=h[b]={},m=!0;else if(o==="module")n=l[p]={id:b,uri:"",exports:h[b]};else if(h.hasOwnProperty(o)||i.hasOwnProperty(o))l[p]=f(o);else{if(!r.p)throw b+" missing "+o;r.p.load(r.n,c(k,!0),e(o),{}),l[p]=h[o]}}q=j.apply(h[b],l),b&&(n&&n.exports!==a?h[b]=n.exports:m||(h[b]=q))}else b&&(h[b]=j)},requirejs=l=function(b,c,d,e){return typeof b=="string"?f(g(b,c).f):(b.splice||(c.splice?(b=c,c=arguments[2]):b=[]),e?k(a,b,c,d):setTimeout(function(){k(a,b,c,d)},15),l)},l.config=function(){return l},require||(require=l),define=function(a,b,c){b.splice||(c=b,b=[]),define.unordered?i[a]=[a,b,c]:k(a,b,c)},define.amd={jQuery:!0}})(),define("almond",[],function(){}),define("app/main",["require"],function(a){var b=sjs.Scene({w:640,h:480});b.loadImages(["images/avatar.jpg"],function(){var a=b.Sprite("images/avatar.jpg");a.size(55,30),a.update(),a.offset(50,50),a.move(100,100),a.rotate(.785),a.scale(2),a.setOpacity(.8),a.update()})}),requirejs.config({baseUrl:"js/lib",paths:{app:"../app",images:"../../images"}}),requirejs(["app/main"]),define("app",function(){})